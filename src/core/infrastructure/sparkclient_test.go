package infrastructure

import "testing"

func TestSparkClient_ListRooms(t *testing.T) {
	sc := NewSparkClient("fake-api-key")
	sc.GetResourceFn = mockGetResourceFn(roomData, nil)
	rooms, err := sc.ListRooms()
	if err != nil {
		t.Error(err)
	}
	t.Logf("ROOMS: %+v", rooms)
	if len(rooms) != 21 {
		t.Errorf("incorrect number of rooms found; expected 21 got: %d", len(rooms))
	}
}

func mockGetResourceFn(payload []byte, err error) func(string) ([]byte, error) {
	return func(url string) ([]byte, error) {
		return payload, err
	}
}

var roomData = []byte(`{"items":[{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vM2VlYTM0MWMtNzljZC0zMzIxLTkzMzEtZjczNmJhZjQ1NTgz","title":"Sparky","type":"direct","isLocked":false,"lastActivity":"2016-11-03T20:03:44.911Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yZjdiYjQ4MS01MzRlLTQxYWEtOTI0OC1mMWZhZWMzOTM5ZjA","created":"2016-11-03T20:03:43.053Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vM2FlMmNhNjAtYTIwMC0xMWU2LWFmYzEtOTFlNWMyOWM4NjY1","title":"MustWin","type":"group","isLocked":true,"lastActivity":"2016-11-03T21:00:41.422Z","teamId":"Y2lzY29zcGFyazovL3VzL1RFQU0vM2FlMmNhNjAtYTIwMC0xMWU2LWFmYzEtOTFlNWMyOWM4NjY1","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yZjdiYjQ4MS01MzRlLTQxYWEtOTI0OC1mMWZhZWMzOTM5ZjA","created":"2016-11-03T20:00:55.302Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vZjVmMmQ2YjAtOWZhZC0xMWU2LTgxOWYtN2ZiZDhmMDUzOWZk","title":"MustWin | Customer Project Examples","type":"group","isLocked":false,"lastActivity":"2016-11-02T18:17:42.555Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS80ODlhYmRiOS0zYzMwLTQyNjAtYjI2OS02ZTk3ZjlkNTFiZTU","created":"2016-10-31T21:06:58.587Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vZWJjYTYwMGEtYmFiOS0zYWM0LThhYTctZjU1YjlkYmRiMjI0","title":"Ryan","type":"direct","isLocked":false,"lastActivity":"2016-08-25T21:28:27.803Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yZjdiYjQ4MS01MzRlLTQxYWEtOTI0OC1mMWZhZWMzOTM5ZjA","created":"2016-08-08T17:53:04.137Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vNzg0MDBmYjMtMjJmNC0zZmY2LWI1MWMtMTYxNTQ3ZGQ3MTcx","title":"Dmitri Chtchourov","type":"direct","isLocked":false,"lastActivity":"2016-08-08T20:01:10.401Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yZjdiYjQ4MS01MzRlLTQxYWEtOTI0OC1mMWZhZWMzOTM5ZjA","created":"2016-08-08T17:39:23.516Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vNjZmMjJiM2ItMjg1MS0zMDEwLTg5YjMtM2M2ZmU4NjFmM2Jj","title":"Chi Nguyen","type":"direct","isLocked":false,"lastActivity":"2016-08-18T16:19:32.049Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yZjdiYjQ4MS01MzRlLTQxYWEtOTI0OC1mMWZhZWMzOTM5ZjA","created":"2016-08-05T15:35:02.313Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vYmNhYTNkOTAtNDNmOS0xMWU2LTk2ZmYtODU2ZjBiODliODdl","title":"CLUS16 Shipped","type":"group","isLocked":false,"lastActivity":"2016-07-13T20:27:04.090Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS84NTRiYzMyMS0wODJhLTQxNzktYWUxMC05MjlkMjA0ODE5YmU","created":"2016-07-07T04:17:37.257Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vMGJhYWNiY2YtODNmZC0zMmM1LWI4M2EtNTQ0ZjA5MmE0MjMx","title":"Fabio Giannetti","type":"direct","isLocked":false,"lastActivity":"2016-07-06T17:12:32.869Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS9kZWZlMzIzNS1jODA4LTQ1MTgtYjJlOC01MjUyNGFhM2E3YTE","created":"2016-06-10T18:06:32.951Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vZDdlMDc5NzAtMjgwYy0xMWU2LTkxY2UtMzVmOWI4MmIzNjhm","title":"Dinesh, Neelesh Pateriya + 1 other","type":"group","isLocked":false,"lastActivity":"2016-06-02T04:56:05.849Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS84NTRiYzMyMS0wODJhLTQxNzktYWUxMC05MjlkMjA0ODE5YmU","created":"2016-06-01T15:23:50.791Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vZGRhNTg1ZTQtMTc0ZC0zNDg0LTg5NjEtNTU2MDMyZjdmNmZj","title":"David Tootill","type":"direct","isLocked":false,"lastActivity":"2016-08-09T00:12:30.793Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS81ZTc4NWU1MS05MzQzLTQwNDItOWNhNy0zOTUyOWNkOGQ4YTU","created":"2016-04-06T03:24:15.852Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vNjlhNWMxZDUtNjQyOC0zZDk0LTk2ZGYtZGViYmZkNjZlMTJj","title":"Harini Priya -T (hpriya - GDH CONSULTING at Cisco)","type":"direct","isLocked":false,"lastActivity":"2016-02-25T20:09:40.331Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yZjdiYjQ4MS01MzRlLTQxYWEtOTI0OC1mMWZhZWMzOTM5ZjA","created":"2016-02-25T19:27:51.482Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vMTVkNzQ0MjAtOWFkYy0xMWU1LThmZTAtZWY4OTZmMWQyYWQ5","title":"Proxy verification","type":"group","isLocked":false,"lastActivity":"2015-12-07T13:31:17.618Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS81ZTc4NWU1MS05MzQzLTQwNDItOWNhNy0zOTUyOWNkOGQ4YTU","created":"2015-12-04T23:09:35.458Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vZDBiNzk2MzYtNWRlZC0zN2QyLTkwZmItNDU5MjZmM2RkNjJh","title":"Ben Schumacher","type":"direct","isLocked":false,"lastActivity":"2016-08-15T21:54:48.635Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS82YmQ2OGJmNS1hODU3LTQ4YWItODFkZi0xMDAwNGIzNWI1YzU","created":"2015-11-11T16:24:58.523Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vMDQ1NGYzYmQtZmMyNS0zZjIwLWFkNDItNDBmZGRjYjk4Nzdi","title":"Steven Borrelli","type":"direct","isLocked":false,"lastActivity":"2016-08-08T20:06:29.682Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yZjdiYjQ4MS01MzRlLTQxYWEtOTI0OC1mMWZhZWMzOTM5ZjA","created":"2015-09-23T16:15:59.404Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vYzBhZGJlMjAtNWIzZS0xMWU1LWE2MzMtNzliMTVjNmUxOTZk","title":"shipped-support","type":"group","isLocked":true,"lastActivity":"2016-10-05T12:41:34.945Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS84NTRiYzMyMS0wODJhLTQxNzktYWUxMC05MjlkMjA0ODE5YmU","created":"2015-09-15T00:14:38.338Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vYjJhNjg5MGEtOTlhNS0zYTM2LWI2ZDctMmZjZWIyODY0OTll","title":"Neelesh Pateriya","type":"direct","isLocked":false,"lastActivity":"2016-08-25T16:36:28.262Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS84NTRiYzMyMS0wODJhLTQxNzktYWUxMC05MjlkMjA0ODE5YmU","created":"2015-09-14T18:39:19.847Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vM2ZmMjkxZTMtZjVjMy0zYWU5LWFiNDItNmY5MTA0Y2VlNDQy","title":"Mike Ihbe","type":"direct","isLocked":false,"lastActivity":"2015-08-04T18:00:58.310Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS9kYTU1ODgxNi03OWM4LTQ1ODYtOGM4OC1jYjEwOTIxYTdkOGI","created":"2015-08-04T17:56:47.653Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vNWQzMGNkNzAtZmE0ZS0xMWU0LTk5YjMtMDlkMjNhNDUyYjQy","title":"Shipped Leads","type":"group","isLocked":false,"lastActivity":"2016-08-26T20:27:35.018Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS9hNGRkMjI5Ny1jMWY1LTRjNzktYmRlMS0zYjZlNGYzOWNhODQ","created":"2015-05-14T15:32:00.583Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vMzAwNDViMzAtZTQ2MS0xMWU0LTk4NmMtOTlkMjk5ZTQ0NWY4","title":"shipped-api","type":"group","isLocked":false,"lastActivity":"2016-08-24T19:38:19.869Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS82YmQ2OGJmNS1hODU3LTQ4YWItODFkZi0xMDAwNGIzNWI1YzU","created":"2015-04-16T17:51:19.651Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vZjM2NmVhZDAtYWNkNC0xMWU0LWJlMGQtNjliODE5N2FmOTJi","title":"Shipped","type":"group","isLocked":false,"lastActivity":"2016-11-03T17:56:11.444Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS8zYzkyYjA5Ny02ZDg4LTRhNWUtYTFjZS0yNjExYjg5NGViOTM","created":"2015-02-05T01:18:54.461Z"},{"id":"Y2lzY29zcGFyazovL3VzL1JPT00vZjVhYTE0NjAtYTI1ZC0xMWU0LTkwYmQtYjdlYzdiZjRlZTk4","title":"Mantl","type":"group","isLocked":false,"lastActivity":"2016-11-03T13:56:23.708Z","creatorId":"Y2lzY29zcGFyazovL3VzL1BFT1BMRS9hNGRkMjI5Ny1jMWY1LTRjNzktYmRlMS0zYjZlNGYzOWNhODQ","created":"2015-01-22T17:41:56.518Z"}]}`)
